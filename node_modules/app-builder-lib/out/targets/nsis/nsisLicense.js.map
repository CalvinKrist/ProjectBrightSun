{"version":3,"sources":["../../../src/targets/nsis/nsisLicense.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;;AAIA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;;2CAEO,WAAkC,QAAlC,EAAyD,OAAzD,EAA+E,eAA/E,EAAqH,SAArH,EAA6I;AAClJ,UAAM,UAAU,MAAM,2CAA2B,QAAQ,OAAnC,EAA4C,QAA5C,CAAtB;;AACA,QAAI,WAAW,IAAf,EAAqB;AACnB,UAAI,WAAJ;;AACA,UAAI,QAAQ,QAAR,CAAiB,OAAjB,CAAJ,EAA+B;AAC7B,sBAAc,CACZ,kDADY,EAEZ,sBAFY,EAGZ,0CAHY,EAIZ,2BAJY,EAKZ,+DALY,EAMZ,aANY,EAQZ,kCAAkC,KAAK,IAAL,CAAU,4BAAV,EAA4B,mBAA5B,CAAgD,GARtE,CAAd;AAUD,OAXD,MAYK;AACH,sBAAc,CAAC,kCAAkC,OAAO,GAA1C,CAAd;AACD;;AAED,sBAAgB,KAAhB,CAAsB,aAAtB,EAAqC,WAArC;;AACA,UAAI,QAAQ,QAAR,CAAiB,OAAjB,CAAJ,EAA+B;AAC7B,wBAAgB,KAAhB,CAAsB,iBAAtB,EAAyC,CAAC,0CAA0C,OAAO,GAAlD,CAAzC;AACD;;AACD;AACD;;AAED,UAAM,eAAe,MAAM,gCAAgB,QAAhB,CAA3B;;AACA,QAAI,aAAa,MAAb,KAAwB,CAA5B,EAA+B;AAC7B;AACD;;AAED,UAAM,cAA6B,EAAnC;AACA,UAAM,mBAAmB,IAAI,GAAJ,CAAQ,SAAR,CAAzB;AAEA,QAAI,cAA6B,IAAjC;;AACA,SAAK,MAAM,IAAX,IAAmB,YAAnB,EAAiC;AAC/B,uBAAiB,MAAjB,CAAwB,KAAK,cAA7B;;AACA,UAAI,eAAe,IAAnB,EAAyB;AACvB,sBAAc,KAAK,IAAnB;AACD;;AACD,kBAAY,IAAZ,CAAiB,gCAAgC,cAAK,KAAK,cAAV,KAA6B,KAAK,IAAI,KAAK,KAAK,IAAI,GAArG;AACD;;AAED,SAAK,MAAM,CAAX,IAAgB,gBAAhB,EAAkC;AAChC,kBAAY,IAAZ,CAAiB,gCAAgC,cAAK,CAAL,CAAO,KAAK,WAAW,GAAxE;AACD;;AAED,gBAAY,IAAZ,CAAiB,+CAAjB;AACA,oBAAgB,KAAhB,CAAsB,aAAtB,EAAqC,WAArC;AACD,G;;kBAlDqB,kB","sourcesContent":["import { lcid } from \"builder-util/out/langs\"\nimport { getLicenseFiles, getNotLocalizedLicenseFile } from \"../../util/license\"\nimport * as path from \"path\"\nimport { WinPackager } from \"../../winPackager\"\nimport { NsisOptions } from \"./nsisOptions\"\nimport { NsisScriptGenerator } from \"./nsisScriptGenerator\"\nimport { nsisTemplatesDir } from \"./nsisUtil\"\n\nexport async function computeLicensePage(packager: WinPackager, options: NsisOptions, scriptGenerator: NsisScriptGenerator, languages: Array<string>): Promise<void> {\n  const license = await getNotLocalizedLicenseFile(options.license, packager)\n  if (license != null) {\n    let licensePage: Array<string>\n    if (license.endsWith(\".html\")) {\n      licensePage = [\n        \"!define MUI_PAGE_CUSTOMFUNCTION_SHOW LicenseShow\",\n        \"Function LicenseShow\",\n        \"  FindWindow $R0 `#32770` `` $HWNDPARENT\",\n        \"  GetDlgItem $R0 $R0 1000\",\n        \"EmbedHTML::Load /replace $R0 file://$PLUGINSDIR\\\\license.html\",\n        \"FunctionEnd\",\n\n        `!insertmacro MUI_PAGE_LICENSE \"${path.join(nsisTemplatesDir, \"empty-license.txt\")}\"`,\n      ]\n    }\n    else {\n      licensePage = [`!insertmacro MUI_PAGE_LICENSE \"${license}\"`]\n    }\n\n    scriptGenerator.macro(\"licensePage\", licensePage)\n    if (license.endsWith(\".html\")) {\n      scriptGenerator.macro(\"addLicenseFiles\", [`File /oname=$PLUGINSDIR\\\\license.html \"${license}\"`])\n    }\n    return\n  }\n\n  const licenseFiles = await getLicenseFiles(packager)\n  if (licenseFiles.length === 0) {\n    return\n  }\n\n  const licensePage: Array<string> = []\n  const unspecifiedLangs = new Set(languages)\n\n  let defaultFile: string | null = null\n  for (const item of licenseFiles) {\n    unspecifiedLangs.delete(item.langWithRegion)\n    if (defaultFile == null) {\n      defaultFile = item.file\n    }\n    licensePage.push(`LicenseLangString MUILicense ${lcid[item.langWithRegion] || item.lang} \"${item.file}\"`)\n  }\n\n  for (const l of unspecifiedLangs) {\n    licensePage.push(`LicenseLangString MUILicense ${lcid[l]} \"${defaultFile}\"`)\n  }\n\n  licensePage.push('!insertmacro MUI_PAGE_LICENSE \"$(MUILicense)\"')\n  scriptGenerator.macro(\"licensePage\", licensePage)\n}\n"],"sourceRoot":""}
